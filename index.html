<!DOCTYPE html>
<html>
<head>
  <title>Robotica Lab 2</title>
  <meta name="viewport" content="initial-scale=1.0">
  <meta charset="utf-8">
  <style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
  #map {
    height: 80%;
  }
  </style>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">   
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
  <script
  src="https://code.jquery.com/jquery-3.0.0.min.js"
  integrity="sha256-JmvOoLtYsmqlsWxa7mDSLMwa6dZ9rrIdtrrVYRnDRH0="
  crossorigin="anonymous"></script>
</head>
<body>
  <div class="alert alert-success" align ="center">Laboratorio 2 Robótica - Drones</div>
  <div id="map" class="container"></div>
  <div class="container">
    <div class="col">
      <div class="row">
        <div class="btn btn-success" onclick="agregarArea();">Indicar Area</div>
        <div class="btn btn-danger" onclick="agregarObstaculo();">Ingresar Obstáculo</div>
        <div class="btn btn-primary pull-right">Generar misión</div>
      </div>
    </div>
  </div>
  <script>
  var map;
  var infoWindow;
  var polygon;
  var area;
  function initMap() {

    var myLatLng = {lat: -33.5926511, lng: -70.7327125};

    map = new google.maps.Map(document.getElementById('map'), {
      zoom: 13,
      center: myLatLng
    });


    infoWindow = new google.maps.InfoWindow();
  }

  function agregarArea(){
    if(polygon) polygon.setMap(null);
    var current = map.getCenter();
    current =  [{lat: current.lat(), lng: current.lng()},{lat: current.lat(), lng: current.lng()}];
    polygon = new google.maps.Polygon({
      map: map,
      paths: current,
      strokeColor: '#FF0000',
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: '#FF0000',
      fillOpacity: 0.35,
      draggable: true,
      geodesic: true,
      editable: true
    });
    infoWindow.setContent("Se ha ingresado una nueva area");
    infoWindow.setPosition(map.getCenter());

    infoWindow.open(map);

    setTimeout(function() {

      infoWindow.close(map);
    }, 1500);
    google.maps.event.addListener(polygon, "dragend", getPath);
    google.maps.event.addListener(polygon.getPath(), "insert_at", getPath);
    google.maps.event.addListener(polygon.getPath(), "remove_at", getPath);
    google.maps.event.addListener(polygon.getPath(), "set_at", getPath);

  }
  function getPath(){
    area= polygon.getPath();
    infoWindow.setContent("Se ha cambiado el area");
    infoWindow.setPosition(map.getCenter());

    infoWindow.open(map);

    setTimeout(function() {

      infoWindow.close(map);
    }, 1500);
  }
function agregarObstaculo(){
  var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';


  var marker = new google.maps.Marker(
  {
      map:map,
      draggable:true,
      animation: google.maps.Animation.DROP,
      position: map.getCenter(),
      icon: iconBase + 'schools_maps.png'

  });
  google.maps.event.addListener(marker, 'dragend', function() 
  {
      console.log(marker.getPosition());
  });
}
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDNU3lXIG8aBek6Zf67cufU8IjM8OlvlcQ&callback=initMap"
  async defer></script>
</body>
</html>